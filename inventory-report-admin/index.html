<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
  <div class="bg-white shadow-lg rounded-lg p-8 w-96">
    <h2 class="text-2xl font-bold text-center mb-6">Dashboard Login</h2>
    <div>
      <input type="email" id="email" placeholder="Email"
        class="w-full border border-gray-300 rounded p-3 mb-4 focus:ring focus:ring-blue-300" />
      <input type="password" id="password" placeholder="Password"
        class="w-full border border-gray-300 rounded p-3 mb-4 focus:ring focus:ring-blue-300" />
      <button id="loginBtn"
        class="w-full bg-blue-600 text-white font-bold p-3 rounded hover:bg-blue-700 transition">
        Login
      </button>
      <p id="error" class="text-red-500 text-center mt-3"></p>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script type="text/javascript">
    const token = localStorage.getItem('token');
    if (token) {
      window.location.href = '/inventory-report-admin/dashboard.html';
    }
    $(document).on("contextmenu", function(e) {
        e.preventDefault();
    });
    $(document).on("keydown", function(e) {
        if (e.keyCode == 123 || // F12
            (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) || // Ctrl+Shift+I/J
            (e.ctrlKey && e.keyCode == 85)) { // Ctrl+U
            e.preventDefault();
            return false;
        }
    });
    (function() {
        var threshold = 160; // Width difference to detect DevTools
        setInterval(function() {
            if (window.outerWidth - window.innerWidth > threshold || window.outerHeight - window.innerHeight > threshold) {
                document.body.innerHTML = "<h2>Developer Tools are not allowed!</h2>";
                window.location.href = "about:blank"; // or any warning page
            }
        }, 1000);
    })();
    Object.defineProperty(window, 'devtoolsOpen', {
        get: function() {
            return true;
        }
    });
  </script>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    const URL = 'U2FsdGVkX19hyzc5WjKnwJeE9r+/IFyMdznhMX/0sW1Ht4ABbwzd0gK6exuEnd7N04eqeHdJqhMY3psodN82rw==';
    const KEY = 'U2FsdGVkX1+99BfCaCy7mhl0MiyZ4w3I40ZJ+neuSn2boVwGxa0RBvO1BwyhnJKb1jdwdcqRkGX57o/iaqIJ3aaI16Sx5aKeamlG0wuCxe4G1YFmLoWCtRFJwXId1gyA4P4C2o5ZxM/trE7iCB3xOsNlv90Hvgu0X5oH6uq9o2IesXwwKhgmvvm8xx/j9I0B1Ze5x3PGlwYvyoS9c3RK+7boDj2Z63TUV2nK7wVdjonLt6C3va767RZFb2WX7khrL5x2jnV6eD817HIUSzA+aC3PcvAGucq92bGuwrdVDVGmtll5ENfNxCxQhfuxPXgH';
    
    const keyBase64 = "bXlTdXBlclNlY3JldEtleTEyMw==";
    const secretKey = atob(keyBase64);
    let S_URL = null;
    let ANON_KEY = null;
    $.ajax({
        url: '/api/crypto',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ text: URL, action: 'decrypt' }),
        success: function(response) {
            S_URL = response.decrypted;
            $.ajax({
                url: '/api/crypto',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ text: KEY, action: 'decrypt' }),
                success: function(response) {
                    ANON_KEY = response.decrypted;

                    const supabase = createClient(S_URL, ANON_KEY);

                    document.getElementById('loginBtn').addEventListener('click', async () => {
                      const email = document.getElementById('email').value;
                      const password = document.getElementById('password').value;
                      const errorEl = document.getElementById('error');
                      errorEl.textContent = '';

                      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

                      if (error) {
                        errorEl.textContent = error.message;
                      } else {
                        localStorage.setItem('token', data.session.access_token);
                        window.location.href = '/inventory-report-admin/dashboard.html';
                      }
                    });
                  },
                error: function() {
                    $('#result').text('Decryption failed');
                }
            });

        },
        error: function() {
            $('#result').text('Decryption failed');
        }
    });
  </script>
</body>
</html>